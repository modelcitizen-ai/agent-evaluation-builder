(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{232:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var l=a(2115);let o=l.forwardRef(function(e,t){let{title:a,titleId:o,...s}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":o},s),a?l.createElement("title",{id:o},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"}))})},4958:(e,t,a)=>{"use strict";async function l(){console.log("Client: Fetching evaluations from localStorage");try{let e=JSON.parse(localStorage.getItem("evaluations")||"[]");console.log("Client: Found ".concat(e.length," evaluations in localStorage"));let t=new Set,a=e.filter(e=>t.has(e.id)?(console.log("Duplicate ID found: ".concat(e.id,", filtering out duplicate")),!1):(t.add(e.id),!0));return a.length<e.length&&(console.log("Filtered out ".concat(e.length-a.length," duplicate evaluation(s)")),localStorage.setItem("evaluations",JSON.stringify(a))),a.map(e=>(e.toJSON||(e.toJSON=function(){return this}),e))}catch(e){return console.error("Error fetching evaluations from localStorage:",e),[]}}async function o(e){try{console.log("Client: Creating evaluation in localStorage",e.name);let t=JSON.parse(localStorage.getItem("evaluations")||"[]");e.id&&t.some(t=>t.id===e.id)&&(console.log("Warning: Evaluation with ID ".concat(e.id," already exists. Generating new ID.")),e.id=Date.now()),t.unshift(e),localStorage.setItem("evaluations",JSON.stringify(t)),console.log("Client: Successfully created evaluation in localStorage");let a={...e};return a.toJSON||(a.toJSON=function(){return this}),a}catch(e){throw console.error("Error creating evaluation in localStorage:",e),Error("Failed to create evaluation: ".concat(e.message||String(e)))}}async function s(e){try{console.log("Client: Deleting evaluation ".concat(e," from localStorage"));let t=JSON.parse(localStorage.getItem("evaluations")||"[]").filter(t=>t.id!==e);return localStorage.setItem("evaluations",JSON.stringify(t)),console.log("Client: Successfully deleted evaluation from localStorage"),!0}catch(t){throw console.error("Error deleting evaluation ".concat(e," from localStorage:"),t),Error("Failed to delete evaluation: ".concat(t.message||String(t)))}}a.d(t,{Hg:()=>o,Iw:()=>l,am:()=>s})},5418:(e,t,a)=>{Promise.resolve().then(a.bind(a,7433))},5695:(e,t,a)=>{"use strict";var l=a(8999);a.o(l,"useParams")&&a.d(t,{useParams:function(){return l.useParams}}),a.o(l,"usePathname")&&a.d(t,{usePathname:function(){return l.usePathname}}),a.o(l,"useRouter")&&a.d(t,{useRouter:function(){return l.useRouter}}),a.o(l,"useSearchParams")&&a.d(t,{useSearchParams:function(){return l.useSearchParams}})},7433:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var l=a(5155),o=a(5695),s=a(2115),n=a(232),r=a(8112),i=a(4958);function c(){let e=(0,o.useRouter)(),[t,a]=(0,s.useState)([]),[c,d]=(0,s.useState)(null),[u,m]=(0,s.useState)(!0),[g,h]=(0,s.useState)(null);(0,s.useLayoutEffect)(()=>{(async()=>{console.log("Starting to load data in data-scientist page");try{console.log("Loading evaluations from localStorage");let e=await (0,i.Iw)();console.log("Loaded evaluations:",e);let t=!1;for(let a of e)"active"===a.status&&await j(a.id)&&(t=!0);console.log("[loadData] Running comprehensive completion check on page load");let l=await y();l>0&&(t=!0,console.log("[loadData] Comprehensive check updated ".concat(l," evaluation(s)")));let o=t?await (0,i.Iw)():e;console.log("Setting evaluations from database with updated status"),a(o)}catch(e){console.error("Error loading evaluations:",e),console.error("Error details:",JSON.stringify(e,null,2)),h("Failed to load evaluations. Please refresh the page.")}finally{m(!1)}})();let e=setInterval(async()=>{try{if("visible"===document.visibilityState&&(console.log("[periodic check] Checking evaluation completion status"),await y()>0)){console.log("[periodic check] Updates detected, refreshing evaluations list");let e=await (0,i.Iw)();a(e)}}catch(e){console.error("[periodic check] Error checking evaluation status:",e)}},3e3);return()=>{clearInterval(e)}},[e]);let x=(0,l.jsx)("div",{className:"flex space-x-3",children:(0,l.jsx)("button",{onClick:()=>e.push("/data-scientist/new"),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"New Evaluation"})}),v=t=>{e.push("/data-scientist/edit/".concat(t))},f=t=>{e.push("/data-scientist/evaluation/".concat(t,"/progress"))},p=async e=>{if(confirm("Are you sure you want to delete this evaluation? This action cannot be undone."))try{if(await (0,i.am)(e)){let l=t.filter(t=>t.id!==e);a(l)}else alert("Failed to delete evaluation. Please try again.")}catch(e){console.error("Error deleting evaluation:",e),alert("An error occurred while deleting the evaluation.")}},w=t=>{e.push("/data-scientist/new/assign-reviewers?evaluationId=".concat(t))};(0,s.useEffect)(()=>{let e=e=>{if(null!==c){let t=e.target,a=document.querySelectorAll(".dropdown-menu"),l=!1;a.forEach(e=>{e.contains(t)&&(l=!0)}),l||d(null)}};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[c]),(0,s.useEffect)(()=>{let e=async e=>{try{let{evaluationId:t}=e.detail;if(console.log("[evaluationCompleted] Received completion event for evaluation ".concat(t)),await j(t)){console.log("[evaluationCompleted] Evaluation ".concat(t," status was updated, refreshing list"));let e=await (0,i.Iw)();a(e)}}catch(e){console.error("[evaluationCompleted] Error handling completion event:",e)}};return window.addEventListener("evaluationCompleted",e),()=>{window.removeEventListener("evaluationCompleted",e)}},[]);let y=async()=>{try{console.log("[forceCheckAllEvaluationCompletions] Starting comprehensive completion check");let e=JSON.parse(localStorage.getItem("evaluations")||"[]"),t=JSON.parse(localStorage.getItem("evaluationReviewers")||"[]"),a=0,l=!1;for(let o of e)if("completed"!==o.status){let e=t.filter(e=>e.evaluationId===o.id.toString()||e.evaluationId===o.id);e.length>0&&e.every(e=>{let t="completed"===e.status,a=e.completed===e.total&&e.total>0,s=t||a;return console.log("[forceCheckAllEvaluationCompletions] Reviewer ".concat(e.name," for eval ").concat(o.id,":"),{status:e.status,completedByStatus:t,completed:e.completed,total:e.total,completedByCount:a,isComplete:s}),a&&"completed"!==e.status&&(e.status="completed",l=!0,console.log("[forceCheckAllEvaluationCompletions] Updated reviewer ".concat(e.name," to completed status (completed all tasks)"))),s})&&(console.log("[forceCheckAllEvaluationCompletions] Found completed evaluation: ".concat(o.name," (").concat(o.id,")")),await j(o.id)&&a++)}return l&&(localStorage.setItem("evaluationReviewers",JSON.stringify(t)),console.log("[forceCheckAllEvaluationCompletions] Saved reviewer status updates")),console.log("[forceCheckAllEvaluationCompletions] Updated ".concat(a," evaluation(s)")),a}catch(e){return console.error("[forceCheckAllEvaluationCompletions] Error during comprehensive check:",e),0}},N=e=>{try{let t=JSON.parse(localStorage.getItem("evaluationReviewers")||"[]").filter(t=>t.evaluationId===e.toString()||t.evaluationId===e);if(0===t.length)return console.log("[checkIfEvaluationIsComplete] No assigned reviewers found for evaluation ".concat(e)),!1;let a=t.every(t=>{let a="completed"===t.status,l=t.completed===t.total&&t.total>0,o=a||l;return console.log("[checkIfEvaluationIsComplete] Reviewer ".concat(t.name," for eval ").concat(e,":"),{status:t.status,completedByStatus:a,completed:t.completed,total:t.total,completedByCount:l,isComplete:o}),o});return console.log("[checkIfEvaluationIsComplete] Evaluation ".concat(e,": ").concat(a?"Complete":"Incomplete",". \n        ").concat(t.length," reviewers, \n        ").concat(t.filter(e=>"completed"===e.status).length," completed by status,\n        ").concat(t.filter(e=>e.completed===e.total&&e.total>0).length," completed by count")),a}catch(t){return console.error("[checkIfEvaluationIsComplete] Error checking evaluation ".concat(e," completion:"),t),!1}},j=async e=>{try{let t=JSON.parse(localStorage.getItem("evaluations")||"[]"),a=t.findIndex(t=>t.id===e);if(-1===a)return console.error("[updateEvaluationStatus] Evaluation ".concat(e," not found")),!1;if(N(e)&&"completed"!==t[a].status)return t[a].status="completed",t[a].completedAt=new Date().toISOString(),localStorage.setItem("evaluations",JSON.stringify(t)),console.log("[updateEvaluationStatus] Updated evaluation ".concat(e," status to completed")),!0;return!1}catch(t){return console.error("[updateEvaluationStatus] Error updating evaluation ".concat(e," status:"),t),!1}};return u?(0,l.jsx)(r.A,{title:"My Projects",actions:x,children:(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsx)("div",{className:"w-12 h-12 border-4 border-gray-200 border-t-indigo-600 rounded-full animate-spin"})})}):g?(0,l.jsx)(r.A,{title:"My Projects",actions:x,children:(0,l.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[60vh]",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-2 text-red-600",children:"Error"}),(0,l.jsx)("p",{className:"mb-4",children:g}),(0,l.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"Refresh Page"})]})})}):(0,l.jsxs)(r.A,{title:"My Projects",actions:x,children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-3 mb-8",children:[(0,l.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,l.jsx)("div",{className:"p-5",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("div",{className:"w-8 h-8 bg-gray-600 rounded-md flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-white text-sm font-medium",children:t.filter(e=>"draft"===e.status).length})})}),(0,l.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,l.jsxs)("dl",{children:[(0,l.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Draft"}),(0,l.jsxs)("dd",{className:"text-lg font-medium text-gray-900",children:[t.filter(e=>"draft"===e.status).length," total"]})]})})]})})}),(0,l.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,l.jsx)("div",{className:"p-5",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("div",{className:"w-8 h-8 bg-gray-600 rounded-md flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-white text-sm font-medium",children:t.filter(e=>"active"===e.status).length})})}),(0,l.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,l.jsxs)("dl",{children:[(0,l.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Active"}),(0,l.jsxs)("dd",{className:"text-lg font-medium text-gray-900",children:[t.filter(e=>"active"===e.status).length," total"]})]})})]})})}),(0,l.jsx)("div",{className:"bg-white overflow-hidden shadow rounded-lg",children:(0,l.jsx)("div",{className:"p-5",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("div",{className:"w-8 h-8 bg-gray-600 rounded-md flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-white text-sm font-medium",children:t.filter(e=>"completed"===e.status).length})})}),(0,l.jsx)("div",{className:"ml-5 w-0 flex-1",children:(0,l.jsxs)("dl",{children:[(0,l.jsx)("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Completed"}),(0,l.jsxs)("dd",{className:"text-lg font-medium text-gray-900",children:[t.filter(e=>"completed"===e.status).length," total"]})]})})]})})})]}),(0,l.jsxs)("div",{className:"bg-white shadow overflow-visible sm:rounded-md",children:[(0,l.jsx)("div",{className:"px-4 py-5 sm:px-6 border-b border-gray-200",children:(0,l.jsx)("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Recent Projects"})}),(0,l.jsx)("div",{className:"bg-white shadow overflow-visible sm:rounded-md",children:(0,l.jsx)("ul",{className:"divide-y divide-gray-200",children:0===t.length?(0,l.jsx)("li",{className:"py-4 px-6 text-center text-gray-500",children:"No evaluations found. Create your first evaluation."}):t.map(t=>(0,l.jsx)("li",{className:c===t.id?"relative z-50":"",children:(0,l.jsx)("div",{className:"px-4 py-4 sm:px-6 hover:bg-gray-50",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"flex items-center flex-1 min-w-0",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{onClick:()=>v(t.id),className:"text-sm font-medium text-gray-900 truncate hover:text-indigo-600 transition-colors duration-200 ease-in-out cursor-pointer text-left",children:t.name}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:[(()=>{if(!t.data||!Array.isArray(t.data)||0===t.data.length)return t.totalItems;let e=["id","item_id","sample_id","row_id","record_id","uuid","ID","Item_ID","Sample_ID","Row_ID","Record_ID","UUID","Record ID","Item ID","Sample ID","Row ID","record id","item id","sample id","row id"],a=null;for(let l of e)if(t.data[0]&&t.data[0].hasOwnProperty(l)){a=l;break}if(!a&&t.data[0]){for(let l of Object.keys(t.data[0]))if(e.some(e=>e.toLowerCase()===l.toLowerCase())){a=l;break}}if(!a&&t.data[0])for(let e of Object.keys(t.data[0])){let t=e.toLowerCase().replace(/[^a-z]/g,"");if(t.includes("id")||t.includes("record")||t.includes("sample")||t.includes("item")||t.includes("row")){a=e;break}}return a&&new Set(t.data.map(e=>String(e[a]||"").trim()).filter(e=>""!==e&&"null"!==e&&"undefined"!==e)).size||t.totalItems})()," Samples • ",t.totalItems," Questions • ","completed"===t.status?"Completed":"Created"," ",new Date(t.createdAt).toLocaleDateString()]})]})}),(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)("span",{className:"inline-flex items-center px-3.5 py-1 rounded-full text-xs font-medium ".concat("draft"===t.status?"bg-gray-100 text-gray-800":"active"===t.status?"bg-green-100 text-green-800":"completed"===t.status?"bg-blue-100 text-gray-800":"bg-gray-100 text-gray-800"),children:"draft"===t.status?"Draft":"active"===t.status?"Active":"completed"===t.status?"Completed":t.status}),(0,l.jsxs)("div",{className:"relative z-10",children:[(0,l.jsx)("button",{onClick:()=>d(c===t.id?null:t.id),className:"p-2 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100 relative z-10",children:(0,l.jsx)(n.A,{className:"h-5 w-5"})}),c===t.id&&(0,l.jsx)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-[99999] border border-gray-200 dropdown-menu",children:(0,l.jsxs)("div",{className:"py-1",children:[(0,l.jsx)("button",{onClick:()=>{v(t.id),d(null)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Edit"}),(0,l.jsx)("button",{onClick:()=>{e.push("/reviewer/task/".concat(t.id,"?from=data-scientist")),d(null)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Preview"}),(0,l.jsx)("button",{onClick:()=>{f(t.id),d(null)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"View Progress"}),(0,l.jsx)("button",{onClick:()=>{w(t.id),d(null)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Add Reviewers"}),(0,l.jsx)("button",{onClick:()=>{p(t.id),d(null)},className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100",children:"Delete"})]})})]})]})]})})},t.id))})})]})]})}},8112:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var l=a(5155),o=a(5695);function s(e){let{title:t,subtitle:a,children:s,actions:n}=e;return(0,o.useRouter)(),(0,l.jsxs)("div",{className:"min-h-[calc(100vh-4rem)] bg-gray-50 pt-9",children:[(0,l.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-2",children:(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,l.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:t}),a&&(0,l.jsx)("p",{className:"text-sm text-gray-600",children:a})]}),n&&(0,l.jsx)("div",{className:"flex-shrink-0 ml-4",children:n})]})}),(0,l.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:s})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(5418)),_N_E=e.O()}]);